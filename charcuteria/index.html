<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Menu Board - Charcuter√≠a Ofertas</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-image: url('charcuteria.png'); 
            --primary-orange: #FF6600;
            --sale-red: #D32F2F;
            --text-dark: #333;
            --price-ref-color: #e65100;
            --price-divisa-color: #0277bd;
        }

        /* 1. Reset & Setup */
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden; 
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Roboto', sans-serif;
        }

        /* 2. Main Canvas 1920x1080 */
        #main-canvas {
            width: 1920px;
            height: 1080px;
            position: relative;
            overflow: hidden;
            background-image: var(--bg-image);
            background-size: cover;
            flex-shrink: 0; 
            transform-origin: center center; 
        }

        /* --- STATIC SECTION (Top Grid - SALES/OFERTAS) --- */
        #static-container {
            position: absolute;
            top: 70px;
            left: 500px;
            width: 1380px; 
            height: 720px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center; 
            align-content: flex-start;
            gap: 20px;
            z-index: 2;
        }

        .static-card {
            background: white;
            border-radius: 20px;
            width: 250px; 
            height: 340px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Stack from top */
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
            box-sizing: border-box;
            border: 2px solid white;
        }

        /* Highlight border for sales feel */
        /* .static-card:nth-child(even) { border-bottom: 5px solid var(--primary-orange); } */
        /* .static-card:nth-child(odd) { border-bottom: 5px solid var(--sale-red); } */

        .static-card img {
            width: 100%;
            height: 160px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        .static-card .product-name { 
            font-size: 1.4rem; 
            font-weight: 700; 
            color: var(--text-dark);
            line-height: 1.1;
            text-align: center;
            height: 45px;
            overflow: hidden;
            display: flex;
            align-items: start;
            justify-content: center;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 800;
        }
        
        .static-price-container {
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 15px;
            padding: 5px 0;
        }

        /* The Main Sale Price */
        .sale-price-big {
            font-family: 'Oswald', sans-serif;
            font-size: 3rem;
            color: var(--sale-red);
            line-height: 1;
        }
        .sale-label {
            font-size: 0.9rem;
            font-weight: 900;
            color: #333;
            letter-spacing: 1px;
            margin-bottom: -5px;
        }

        /* The Secondary Price (small) */
        .secondary-price {
            margin-top: 5px;
            font-size: 1rem;
            color: #777;
            font-weight: 500;
        }

        /* --- SCROLLING SECTION (Bottom Horizontal) --- */
        .scroll-window {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%; 
            height: 260px; 
            overflow: hidden;
            z-index: 2;
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
            mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
        }

        #scroll-track {
            display: flex;
            flex-direction: row; 
            align-items: center;
            height: 100%;
            position: absolute;
            left: 0;
            will-change: transform;
            gap: 30px; 
            padding-left: 30px; 
        }

        .scroll-card {
            background: white;
            border-radius: 20px;
            min-width: 400px; 
            height: 200px;   
            padding: 15px;
            display: flex;
            flex-direction: row; 
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            box-sizing: border-box;
        }

        .scroll-card img {
            width: 160px;
            height: 100%;
            object-fit: contain;
            margin-right: 15px;
        }

        .scroll-card .details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            height: 100%;
            border-left: 2px solid #eee;
            padding-left: 15px;
        }

        .scroll-card .product-name {
            text-align: left;
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--text-dark);
            height: auto;
            max-height: 70px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        /* Standard sizing for scroll items */
        .scroll-price-ref { font-size: 2.2rem; font-weight: 900; color: var(--price-ref-color); line-height: 1;}
        .scroll-price-ref span { font-size: 1rem; color: #666; font-weight: normal; }
        .scroll-price-divisa { font-size: 1.3rem; font-weight: 700; color: var(--price-divisa-color); margin-top: 5px;}

    </style>
</head>
<body>

    <div id="main-canvas">
        <div id="static-container"></div>
        <div class="scroll-window">
            <div id="scroll-track"></div>
        </div>
    </div>

    <script>
        /* --- AUTO SCALE SCRIPT --- */
        function scaleMenu() {
            const canvas = document.getElementById('main-canvas');
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const scaleX = windowWidth / 1920;
            const scaleY = windowHeight / 1080;
            const scale = Math.min(scaleX, scaleY);
            canvas.style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', scaleMenu);
        scaleMenu(); 

        /* --- CONFIG & DATA --- */
        const PRODUCTS_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT7cTx6hygxELF5v4pMg4TadaCluMR1n535MVVoUaEvvoJtThvWhQmlUApSFh4qajpnEeBwaD02aOgd/pub?gid=0&single=true&output=csv";
        const CONFIG_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRpYcutQnWmMA4HQHTf0Bo_qwK6al5zp-m4QdgaXw4sNOO7jIFJ2-uKtzX3645UfvsIBp1P2BXmz38Z/pub?gid=0&single=true&output=csv";
        
        const staticContainer = document.getElementById('static-container');
        const scrollTrack = document.getElementById('scroll-track');

        let scrollSpeed = 1.5; 
        let featuredCount = 9; 

        let animationFrameId;
        let currentScrollX = 0;
        let singleSetWidth = 0;

        async function loadConfig() {
            try {
                const response = await fetch(CONFIG_URL);
                const text = await response.text();
                const lines = text.split('\n');
                lines.forEach(line => {
                    const [key, value] = line.split(',');
                    if (!key) return;
                    const cleanKey = key.trim();
                    const cleanVal = parseFloat(value);
                    if (cleanKey === 'scroll') scrollSpeed = cleanVal || scrollSpeed;
                    if (cleanKey === 'fav_items_char') featuredCount = cleanVal || featuredCount;
                });
            } catch (e) { console.warn("Using defaults", e); }
        }

        async function init() {
            await loadConfig();
            try {
                const response = await fetch(PRODUCTS_URL);
                const text = await response.text();
                const allProducts = csvToJson(text);

                const staticItems = allProducts.slice(0, featuredCount);
                const scrollingItems = allProducts.slice(featuredCount);

                if (animationFrameId) cancelAnimationFrame(animationFrameId);
                
                staticContainer.innerHTML = '';
                scrollTrack.innerHTML = '';

                renderStatic(staticItems);

                if (scrollingItems.length > 0) {
                    renderScrolling(scrollingItems);
                    // Measure 1 set width
                    singleSetWidth = scrollTrack.scrollWidth + 30; // + gap
                    // Duplicate for loop
                    renderScrolling(scrollingItems); 
                    currentScrollX = 0;
                    startHorizontalScroll();
                }
            } catch (e) { console.error("Error initializing", e); }
        }

        function renderStatic(items) {
            items.forEach(p => {
                /* LOGIC: 
                   1. If 'divisa' exists -> It is Main "OFERTA". 'ref' is Secondary.
                   2. If 'divisa' missing -> 'ref' becomes Main "OFERTA". Secondary is hidden.
                */
                
                let mainPrice = "";
                let secondaryPriceHtml = "";
                
                if (p.divisa && p.divisa !== "") {
                    // Scenario 1: Divisa exists -> It is the Sale Price
                    mainPrice = `$${p.divisa}`;
                    
                    // Show REF as secondary ONLY if it exists
                    if (p.ref && p.ref !== "") {
                        secondaryPriceHtml = `<div class="secondary-price">REF: $${p.ref}</div>`;
                    }
                } else if (p.ref && p.ref !== "") {
                    // Scenario 2: Divisa missing -> REF takes the big slot
                    mainPrice = `$${p.ref}`;
                    // No secondary price
                    secondaryPriceHtml = "";
                } else {
                    // Scenario 3: No prices at all
                    mainPrice = "";
                }

                // If no main price found at all, hide the price block or show placeholder? 
                // We will just render nothing in price block.
                const priceBlock = mainPrice ? `
                    <div class="sale-label">OFERTA</div>
                    <div class="sale-price-big">${mainPrice}</div>
                    ${secondaryPriceHtml}
                ` : `<div style="height:50px"></div>`;

                const html = `
                    <div class="static-card">
                        <div class="product-name">${p.nombre}</div>
                        <img src="${p.imagen}" onerror="this.style.opacity='0'">
                        <div class="static-price-container">
                            ${priceBlock}
                        </div>
                    </div>
                `;
                staticContainer.insertAdjacentHTML('beforeend', html);
            });
        }

        function renderScrolling(items) {
            items.forEach(p => {
                /* LOGIC: Show price ONLY if it exists in CSV */
                
                const refHtml = (p.ref && p.ref !== "") 
                    ? `<div class="scroll-price-ref"><span>REF</span> $${p.ref}</div>` 
                    : '';
                
                const divisaHtml = (p.divisa && p.divisa !== "") 
                    ? `<div class="scroll-price-divisa">Divisa $${p.divisa}</div>` 
                    : '';

                const html = `
                    <div class="scroll-card">
                        <img src="${p.imagen}" onerror="this.style.opacity='0'">
                        <div class="details">
                            <div class="product-name">${p.nombre}</div>
                            ${refHtml}
                            ${divisaHtml}
                        </div>
                    </div>
                `;
                scrollTrack.insertAdjacentHTML('beforeend', html);
            });
        }

        function startHorizontalScroll() {
            function step() {
                currentScrollX -= scrollSpeed; 
                if (Math.abs(currentScrollX) >= singleSetWidth) {
                    currentScrollX += singleSetWidth;
                }
                scrollTrack.style.transform = `translateX(${currentScrollX}px)`;
                animationFrameId = requestAnimationFrame(step);
            }
            animationFrameId = requestAnimationFrame(step);
        }

        function csvToJson(csv) {
            const lines = csv.split('\n');
            return lines.slice(1).map(line => {
                const cols = line.split(',');
                if(cols.length < 3) return null;
                return { 
                    nombre: cols[0]?.trim(), 
                    ref: cols[1]?.trim(), 
                    divisa: cols[2]?.trim(), 
                    imagen: cols[3]?.trim() 
                };
            }).filter(p => p && p.nombre);
        }

        init();
        setInterval(init, 60000); 

    </script>
</body>
</html>

