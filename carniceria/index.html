<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Menu Board - Full Scale</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Roboto:wght@400;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-image: url('background.png'); 
            --primary-orange: #FF6600;
        }

        /* 1. Fondo negro total y centrado del contenido */
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden; 
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Roboto', sans-serif;
        }

        /* 2. El "Lienzo" de 1920x1080 */
        #main-canvas {
            width: 1920px;
            height: 1080px;
            position: relative;
            overflow: hidden;
            background-image: var(--bg-image);
            background-size: cover;
            flex-shrink: 0; /* Evita que el flexbox lo deforme */
            transform-origin: center center; /* Escala desde el centro */
        }

        /* Ajustes de tus elementos originales (ahora relativos al canvas) */
        .background-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        .scroll-window {
            position: absolute;
            top: 20px;
            left: 680px;
            width: 1220px; 
            height: 1000px; 
            overflow: hidden;
            z-index: 2;
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%);
        }

        #scroll-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            position: relative;
            top: 0;
        }

        .card {
            background: white;
            border-radius: 25px;
            padding: 25px;
            height: 480px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            box-sizing: border-box;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card img { height: 280px; width: 100%; object-fit: contain; }
        .product-name { 
            overflow: hidden;
            align-content: center;
            height: 75px;
            font-size: 1.8rem; 
            font-weight: 900;
            color: #333;
            text-align: center; 
        }
        
        .price-ref { font-size: 2.5rem; font-weight: 900; color: #e65100; }
        .price-ref span { font-size: 1.2rem; color: #666; font-weight: normal; }
        .price-divisa { font-size: 1.4rem; font-weight: 700; color: #0277bd; text-align: center;}

        .side-image {
            position: absolute;
            bottom: 0; left: 0;
            object-fit: cover;
            z-index: 3;
        }
    </style>
</head>
<body>

    <div id="main-canvas">
        <div class="background-layer"></div>
        <img class="side-image" src="carniceria.png">
        <div class="scroll-window">
            <div id="scroll-container"></div>
        </div>
    </div>

    <script>
        /* SCRIPT DE ESCALADO AUTOMÁTICO */
        function scaleMenu() {
            const canvas = document.getElementById('main-canvas');
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            // Calculamos la escala basada en el ancho y alto disponible
            const scaleX = windowWidth / 1920;
            const scaleY = windowHeight / 1080;
            
            // Usamos la escala más pequeña para que no se corte nada (fit)
            const scale = Math.min(scaleX, scaleY);
            
            canvas.style.transform = `scale(${scale})`;
        }

        window.addEventListener('resize', scaleMenu);
        scaleMenu(); // Ejecutar al cargar

        /* TU LÓGICA DE DATOS */
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQdYJo8hW_1GmjLp9NQ4lT3jPU-Q0fqghtzMp3ypnWbgLILR1j-NYxqarjlEWPPy4_fozgD-A-DER_U/pub?gid=0&single=true&output=csv";
        const CONFIG_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRpYcutQnWmMA4HQHTf0Bo_qwK6al5zp-m4QdgaXw4sNOO7jIFJ2-uKtzX3645UfvsIBp1P2BXmz38Z/pub?gid=0&single=true&output=csv";
        const scrollContainer = document.getElementById('scroll-container');

        let scrollSpeed = 2;

        async function loadConfig() {
            try {
                const response = await fetch(CONFIG_URL);
                const text = await response.text();
                const lines = text.split('\n');
                lines.forEach(line => {
                    const [key, value] = line.split(',');
                    if (key === 'scroll') scrollSpeed = parseFloat(value) || scrollSpeed;
                });
            } catch (e) { console.warn("No se pudo cargar la configuración", e); }
        }

        async function init() {
            loadConfig();
            try {
                const response = await fetch(CSV_URL);
                const text = await response.text();
                const products = csvToJson(text);
                
                scrollContainer.innerHTML = ''; // Limpiar antes de renderizar
                render(products);
                render(products); 
                
                startInfiniteScroll();
            } catch (e) { console.error("Error cargando CSV", e); }
        }

        function render(products) {
            
            products.forEach(p => {
                const html = `
                    <div class="card">
                        <img src="${p.imagen}">
                        <div class="product-name">${p.nombre}</div>
                        <div>
                            <div class="price-ref"><span>REF</span> $${p.ref}</div>
                            <div class="price-divisa">Divisa $${p.divisa}</div>
                        </div>
                    </div>`;
                scrollContainer.insertAdjacentHTML('beforeend', html);
            });
        }

        function startInfiniteScroll() {
            let currentScroll = 0;
            function step() {
                currentScroll -= scrollSpeed;
                scrollContainer.style.transform = `translateY(${currentScroll}px)`;
                if (Math.abs(currentScroll) >= scrollContainer.offsetHeight / 2) {
                    currentScroll = 0;
                }
                requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        function csvToJson(csv) {
            const lines = csv.split('\n');
            return lines.slice(1).map(line => {
                const cols = line.split(',');
                return { nombre: cols[0], ref: cols[1], divisa: cols[2], imagen: cols[3] };
            }).filter(p => p.nombre);
        }

        init();
        setInterval(init, 60000); 
    </script>
</body>
</html>